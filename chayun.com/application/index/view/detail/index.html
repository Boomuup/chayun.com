{include file="public/css" /}
<link rel="stylesheet" type="text/css" href="/static/index/css/detail.css"/>
{include file="public/header" /}
</div>
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md3">
            <div class="smallnav">
                <a href="index.html">首页</a> > <a href="">产品详情</a>
            </div>
        </div>
    </div>
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="product">
                <div class="product-left">
                    <img src="http://chayun.com/static/uploads/{$goods.picture}" >
                </div>
                <div class="product-right">
                    <div class="pro-title">
                        {$goods.goods_name}
                        <i class="layui-icon layui-icon-notice" style="float: right"><a href="" id="inform">降价通知</a></i>
                    </div>
                    <div class="pro-price">
                        <p class="market"><span>市场价</span><del>￥{$goods.original}</del></p>
                        <p class="activity"><span>活动价</span><b>￥{$goods.price}</b></p>
                        <p class="sale"><span>销&nbsp;&nbsp;&nbsp;量</span><span>{$goods.sales}</span></p>
                    </div>
                    <div class="right-bottom">
                        <p class="weight"><span>重&nbsp;&nbsp;&nbsp;量</span><span>{$goods.weight}{$goods.unit}</span></p>
                        <div class="num">
                            <span>数&nbsp;&nbsp;&nbsp;量</span>
                            <button class="minus">-</button><input class="shopnum" value="1" type="text"><button class="add">+</button>  库存余 {$goods.store} 件
                        </div>
                        <div class="buybtn">
                            <button class="buynow" id="buynow">立即购买</button>
                            <button class="addcar" id="cartbtn"><i class="iconfont icon-che"></i>&nbsp;&nbsp;加入购物车</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="product-detail">
                <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                    <ul class="layui-tab-title">
                        <li class="layui-this">商品详情</li>
                        <li>商品评论</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div id = "content1"  hidden="hidden">
                            {$goods.content}
                        </div>
                        <div id = "content2"  hidden="hidden">

                        </div>
                        <div class="layui-tab-item layui-show" id="content3"></div>
                        <div class="layui-tab-item">
                            <div class="layui-row">
                                <div class="layui-col-md6">
                                    <div class="left-score" style="margin-left: 20px;margin-top:18px">
                                        <span>好评率: </span>
                                        <span class="fontset" style="font-weight: lighter;font-size: 70px;color: red" id="s1">{$gpercent}%</span>
                                    </div>
                                </div>
                                <div class="layui-col-md6 ">
                                    <div class="layui-row" style="margin-bottom: 15px;margin-top: 15px">
                                        <div class="layui-col-md1">好评:</div>
                                        <div class="layui-col-md6">
                                            <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                                <div class="layui-progress-bar layui-bg-orange" id="s2" lay-percent="{$gpercent}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-row" style="margin-bottom: 15px">
                                        <div class="layui-col-md1">中评:</div>
                                        <div class="layui-col-md6">
                                            <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                                <div class="layui-progress-bar layui-bg-orange" id="s3" lay-percent="{$mpercent}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-row">
                                        <div class="layui-col-md1">差评:</div>
                                        <div class="layui-col-md6">
                                            <div class="layui-progress layui-progress-big" lay-showPercent="yes">
                                                <div class="layui-progress-bar layui-bg-orange" id="s4" lay-percent="{$bpercent}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-tab layui-tab-card" style="width: 1138px;margin-left: -10px;box-shadow: 0 0px 0px white;
                            border-bottom: 0px solid white;border-left: 0px solid white;border-right: 0px solid white;">
                                <ul class="layui-tab-title">
                                    <li class="layui-this">全部评论({if $sum==0.01}0{else}{$sum}{/if})</li>
                                    <li>好评({$goodtotal})</li>
                                    <li>中评({$mediumtotal})</li>
                                    <li>差评({$badtotal})</li>
                                </ul>
                                <div class="layui-tab-content">
                                    <div class="layui-tab-item layui-show">
                                        {volist name="all" id="vo" empty="暂无评论"}
                                        <div class="layui-row">
                                            <div class="layui-col-md1">
                                                <div class="user-icon">
                                                    <img src="/static/uploads/{$vo.icon}" >
                                                </div>
                                            </div>
                                            <div class="layui-col-md10">
                                                <div>
                                                    <div class="name"><span>{$vo.username}</span></div>
                                                    <div><span>{$vo.comment_time|date="Y-m-d H:i:s"}</span></div>
                                                </div>
                                                <div class="star">
                                                    {switch	$vo.score}
                                                    {case 1}<i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 2}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 3}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 4}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {default/}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>
                                                    {/switch}

                                                </div>
                                                <div class="content">
                                                    {$vo.desc}
                                                </div>
                                                <div class="picture">
                                                    <img src="/static/uploads/{$vo.picture}" >
                                                </div>
                                                {if $vo.isreply == 1}
                                                <div class="reply">
                                                    <span>商家回复: {$vo.reply}</span>
                                                </div>
                                                {/if}
                                            </div>
                                        </div>
                                        <div class="layui-row">
                                            <div class="layui-col-md12">
                                                <hr>
                                            </div>
                                        </div>
                                        {/volist}
                                    </div>
                                    <div class="layui-tab-item">
                                        {volist name="good" id="vo" empty="暂无评论"}
                                        <div class="layui-row">
                                            <div class="layui-col-md1">
                                                <div class="user-icon">
                                                    <img src="/static/uploads/{$vo.icon}" >
                                                </div>
                                            </div>
                                            <div class="layui-col-md10">
                                                <div>
                                                    <div class="name"><span>{$vo.username}</span></div>
                                                    <div><span>{$vo.comment_time|date="Y-m-d H:i:s"}</span></div>
                                                </div>
                                                <div class="star">
                                                    {switch	$vo.score}
                                                    {case 1}<i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 2}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 3}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 4}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {default/}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>
                                                    {/switch}

                                                </div>
                                                <div class="content">
                                                    {$vo.desc}
                                                </div>
                                                <div class="picture">
                                                    <img src="/static/uploads/{$vo.picture}" >
                                                </div>
                                                {if $vo.isreply == 1}
                                                <div class="reply">
                                                    <span>商家回复: {$vo.reply}</span>
                                                </div>
                                                {/if}
                                            </div>
                                        </div>
                                        <div class="layui-row">
                                            <div class="layui-col-md12">
                                                <hr>
                                            </div>
                                        </div>
                                        {/volist}
                                    </div>
                                    <div class="layui-tab-item">
                                        {volist name="medium" id="vo" empty="暂无评论"}
                                        <div class="layui-row">
                                            <div class="layui-col-md1">
                                                <div class="user-icon">
                                                    <img src="/static/uploads/{$vo.icon}" >
                                                </div>
                                            </div>
                                            <div class="layui-col-md10">
                                                <div>
                                                    <div class="name"><span>{$vo.username}</span></div>
                                                    <div><span>{$vo.comment_time|date="Y-m-d H:i:s"}</span></div>
                                                </div>
                                                <div class="star">
                                                    {switch	$vo.score}
                                                    {case 1}<i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 2}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 3}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 4}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {default/}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>
                                                    {/switch}

                                                </div>
                                                <div class="content">
                                                    {$vo.desc}
                                                </div>
                                                <div class="picture">
                                                    <img src="/static/uploads/{$vo.picture}" >
                                                </div>
                                                {if $vo.isreply == 1}
                                                <div class="reply">
                                                    <span>商家回复: {$vo.reply}</span>
                                                </div>
                                                {/if}
                                            </div>
                                        </div>
                                        <div class="layui-row">
                                            <div class="layui-col-md12">
                                                <hr>
                                            </div>
                                        </div>
                                        {/volist}
                                    </div>
                                    <div class="layui-tab-item">
                                        {volist name="bad" id="vo" empty="暂无评论"}
                                        <div class="layui-row">
                                            <div class="layui-col-md1">
                                                <div class="user-icon">
                                                    <img src="/static/uploads/{$vo.icon}" >
                                                </div>
                                            </div>
                                            <div class="layui-col-md10">
                                                <div>
                                                    <div class="name"><span>{$vo.username}</span></div>
                                                    <div><span>{$vo.comment_time|date="Y-m-d H:i:s"}</span></div>
                                                </div>
                                                <div class="star">
                                                    {switch	$vo.score}
                                                    {case 1}<i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 2}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 3}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {case 4}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>{/case}
                                                    {default/}<i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i><i class="layui-icon">&#xe67a;</i>
                                                    {/switch}

                                                </div>
                                                <div class="content">
                                                    {$vo.desc}
                                                </div>
                                                <div class="picture">
                                                    <img src="/static/uploads/{$vo.picture}" >
                                                </div>
                                                {if $vo.isreply == 1}
                                                <div class="reply">
                                                    <span>商家回复: {$vo.reply}</span>
                                                </div>
                                                {/if}
                                            </div>
                                        </div>
                                        <div class="layui-row">
                                            <div class="layui-col-md12">
                                                <hr>
                                            </div>
                                        </div>
                                        {/volist}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{include file="public/footer" /}
{include file="public/js" /}
<script type="text/javascript" src="/static/admin/hui/lib/layer/2.4/layer.js"></script>
<script type="text/javascript">
    $(function() {
        $("#content2").html($("#content1").text());
        $("#content3").html($("#content2").text());
    });
</script>
<script>
    layui.use('element', function(){
        var $ = layui.jquery
            ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
    });

    /* 加数量 */
    $('.add').click(function(){
        var shopnum = $('.shopnum').val();
        var maxnum = {$goods.store};    //最大库存
        shopnum++;
        if(shopnum == maxnum) {
            $(".add").attr({"disabled":"disabled"});
        }
        $(".minus").removeAttr("disabled");
        $('.shopnum').val(shopnum);
    });
    /* 减少数量 */
    $('.minus').click(function(){
        var shopnum = $('.shopnum').val();
        if(shopnum==1){
            $(".minus").attr({"disabled":"disabled"});
        } else {
            shopnum--;
            $(".add").removeAttr("disabled");
            $('.shopnum').val(shopnum);
        }
    });
    $('.shopnum').blur(function(){
        var num = $('.shopnum').val();
        var max = {$goods.store};   //获取最大库存
        if(num < 1) {
            $('.shopnum').val(1);
            $(".minus").attr({"disabled":"disabled"});
            $(".add").removeAttr("disabled");
        }
        if(num >= {$goods.store} ) {
            $('.shopnum').val(max);
            $(".add").attr({"disabled":"disabled"});
            $(".minus").removeAttr("disabled");
        }
    });

    $("#buynow").on('click',function(){
        var shopnum = $('.shopnum').val();
        var shopid = {$goods.id};
        var id = {$Think.session.user_info.id};
        window.location.href='{:url("orders/index")}?uid='+ id + '&shopid='+ shopid + '&num=' + shopnum;
    });

    $(function(){
        $("#cartbtn").on('click',function(){
            var shopnum = $('.shopnum').val();
            var shopid = {$goods.id};
            var id = {$Think.session.user_info.id};

            $.ajax({
                url:"{:url('cart/add')}",
                type:"post",
                data:{"num": shopnum,
                      "id":id,
                      "shopid":shopid
                        },
                dataType:"json",
                success:function (data) {
                    if(data.code==1)
                    {
                        layer.msg(data.msg,
                            {
                                icon:1,
                                time:1000
                            });
                    }else{
                        layer.msg(data.msg,
                            {
                                icon:2,
                                time:2000
                            });
                    }
                },error:function (data) {
                    layer.open({
                        icon:2,
                        title:"错误",
                        content:"系统繁忙，请稍后~~",
                    });
                }
            });
            return false;
        })
    })
    //降价通知
    $(function(){
        $("#inform").on('click',function(){
            var shopid = {$goods.id};
            var id = {$Think.session.user_info.id};
            $.ajax({
                url:"{:url('detail/inform')}",
                type:"post",
                data:{
                    "id":id,
                    "shopid":shopid
                },
                dataType:"json",
                success:function (data) {
                    if(data.code==1)
                    {
                        layer.msg(data.msg,
                            {
                                icon:1,
                                time:3000
                            });
                    }else{
                        layer.msg(data.msg,
                            {
                                icon:2,
                                time:2000
                            });
                    }
                },error:function (data) {
                    layer.open({
                        icon:2,
                        title:"错误",
                        content:"系统繁忙，请稍后~~",
                    });
                }
            });
            return false;
        })
    });
</script>

</body>
</html>